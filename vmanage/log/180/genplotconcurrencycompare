# usage: genplot file webdir
basedir=/nfs/vmanage/log/0
#basedir=/nfs/vmanage/plot

# base location on the http server
server="david78k@ssh.acis.ufl.edu"
webdir="net/10.5.144.12/home/users/david78k/migration/wansim/8-8"

expdir=$2
#expdir=2-2/sysid

path=$server:/$webdir/$expdir/

genscript=genscriptconcurrencycompare
# data file *.dat
# data file *.log
file=$1
prefix=${file%\.*}
#data=$file
data=$prefix.dat
dstat=$prefix.dstat
net=$prefix-net.dat
log=$prefix.log

script=$prefix.p
netscript=$prefix-net.p
figures="$prefix.png $prefix.eps"
webpage=$prefix.php
all="$figures $data $dstat $script $webpage"
#all="$figures $data $dstat $net $script $webpage"

if [ $# -lt 2 ]; then
	echo "usage: $0 file webdir"
	exit 
fi

#=============== VMs ====================
# make dat
#if [ ! -e $data ]; then
#	$basedir/gendata $log
#i

# make png
$basedir/$genscript $data
gnuplot $script

# make eps
$basedir/$genscript $data eps
gnuplot $script

#=============== web php upload ====================
$basedir/genphpconcurrency $prefix

#tar cf $prefix.tar $figures $data $script $webpage

echo uploading to "$path" ...

ssh $server "mkdir -p /$webdir/$expdir"
scp $all $path

